<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-1.4.xsd"
        default-menu-include="false" standalone="true">
    <transition name="finishDeliver">
        <default-response url="../Service"/>
    </transition>
    <transition name="doneInvoice">
        <service-call name="tracker.TrackerServices.create#CarInvoice" in-map="context"
                      out-map="context"/>
        <default-response url="../Service"/>
    </transition>
    <actions>
        <entity-find entity-name="service.tracker.CarInvoice" list="getInvoice">
            <econditions>
                <econdition field-name="carNo" value="${carNo}"/>
            </econditions>
        </entity-find>
        <service-call name="tracker.TrackerServices.getDelivery#StatusOfCar" in-map="context" out-map="context"/>
    </actions>
    <widgets>
        <container id="delivery-section">
            <section-iterate name="carDeliver" list="deliveryList" entry="deliver">
                <widgets>
                    <container>
                        <section name="conditionalField">
                            <condition>
                                <expression>getInvoice != null</expression>
                            </condition>
                            <widgets>
                                <label text="${deliver.carNo}"/>
                                <container-dialog id="invoice-delivery" button-text="Invoice">
                                    <form-single name="invoice-form" transition="doneInvoice">
                                        <field name="carNo">
                                            <default-field title="Car No:">
                                                <display text="${deliver.carNo}"/>
                                            </default-field>
                                        </field>
                                        <field name="totalInvoice">
                                            <default-field title="Total Invoice:">
                                                <text-line size="5"/>
                                            </default-field>
                                        </field>
                                        <field name="submitInvoice"> <default-field title="submit"><submit/></default-field></field>
                                    </form-single>
                                </container-dialog>
                            </widgets>
                            <fail-widgets>
                                <form-single name="deliver-list" transition="finishDeliver">
                                    <field name="submitButton"><default-field title="Deliver"><submit/></default-field></field>
                                    <field name="carNo">
                                        <default-field title="">
                                            <display text="${deliver.carNo}"/>
                                        </default-field>
                                    </field>
                                    <field-layout>
                                        <field-row-big><field-ref name="carNo"/><field-ref name="submitButton"/></field-row-big>
                                    </field-layout>
                                </form-single>
                            </fail-widgets>
                        </section>
                    </container>
                </widgets>
            </section-iterate>
        </container>
    </widgets>
</screen>