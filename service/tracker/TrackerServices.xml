<services>
    <service verb="create" noun="ReceptionEntity" authenticate="false">
        <in-parameters>
            <parameter name="CarNo"/>
            <parameter name="Job"/>
            <parameter name="ServiceAdviser"/>
            <parameter name="DriverOrOwner"/>
            <parameter name="Gift"/>
            <parameter name="DropCar"/>
            <parameter name="CustomerWaiting"/>
            <parameter name="CarStatus"/>
        </in-parameters>
        <actions>
            <service-call name="create#service.tracker.ReceptionEntity"  in-map="[CarNo:CarNo, ServiceAdviser:ServiceAdviser,
                                                                                  DriverOrOwner:DriverOrOwner, Gift:Gift,
                                                                                  DropCar:DropCar, CustomerWaiting:CustomerWaiting, Job:Job]"/>
            <service-call name="update#service.tracker.StatusOfCar" in-map="[CarNo:CarNo, CarStatus:'Reception', OutTime:ec.user.getNowTimestamp()]">
                <econditions>
                    <econdition field-name="CarNo" value="${CarNo}"/>
                </econditions>
            </service-call>
            <service-call name="create#service.tracker.StatusOfCar" in-map="[CarNo:CarNo, CarStatus:'Service Adviser', InTime:ec.user.getNowTimestamp()]"/> <!-- Need to change create from update -->
        </actions>
    </service>

    <service verb="create" noun="JobController" authenticate="false">
        <in-parameters>
            <parameter name="CarNo"/>
            <parameter name="Area"/>
            <parameter name="BayNo"/>
            <parameter name="TechnicianId"/>
            <parameter name="AwaitingTechnician"/>
            <parameter name="JobId"/>
            <auto-parameters include="pk" required="true"/>
        </in-parameters>

        <out-parameters><parameter name="JobId"/></out-parameters>

        <actions>
            <service-call name="create#service.tracker.JobController" in-map="[CarNo:CarNo, FromDate:ec.user.getNowTimestamp(), BayNo:BayNo, Area:Area, AwaitingTechnician:AwaitingTechnician]"/>
            <service-call name="update#service.tracker.StatusOfCar" in-map="[CarNo:CarNo, CarStatus:'Job Controller', OutTime:ec.user.getNowTimestamp()]">
                <econditions>
                    <econdition field-name="CarNo" value="${CarNo}"/>
                </econditions>
            </service-call>
            <service-call name="create#service.tracker.StatusOfCar" in-map="[CarNo:CarNo, CarStatus:'Technician', InTime:ec.user.getNowTimestamp()]"/>
            <service-call name="create#service.tracker.Technicians" in-map="[CarNo:CarNo, JobId:JobId, TechnicianId:TechnicianId, FromDate:ec.user.getNowTimestamp()]"/>
        </actions>
    </service>

    <service verb="create" noun="CarController" authenticate="false">
        <in-parameters>
            <auto-parameters include="all"/>
        </in-parameters>
        <actions>
            <service-call name="create#service.tracker.CarController" in-map="context" out-map="context"/>
            <service-call name="create#service.tracker.StatusOfCar" in-map="[CarNo:CarNo, CarStatus:CarStatus]"/>
        </actions>
    </service>

    <service verb="create" noun="TestDrive" authenticate="false">
        <in-parameters>
            <parameter name="CarNo" required="true"/>
            <parameter name="TechnicianId"/>
            <parameter name="JobId"/>
            <parameter name="kmIn" required="true"/>
            <parameter name="kmOut" required="true"/>
            <parameter name="TechnicianId" required="true"/>
        </in-parameters>
        <actions>
            <service-call name="create#service.tracker.TestDrive" in-map="[CarNo:CarNo, kmIn:kmIn, kmOut:kmOut]"/>
            <service-call name="update#service.tracker.JobController" in-map="[CarNo:CarNo, TechnicianId:TechnicianId, AwaitingTechnician:'Test Drive']"/>
        </actions>
    </service>

    <service verb="get" noun="SecurityAndCarStatus" authenticate="false">
        <in-parameters>
            <auto-parameters include="all"/>
        </in-parameters>
        <out-parameters>
            <parameter name="receptionCarList" type="List"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="SecurityAndCarStatus" list="receptionCarList">
                <econditions combine="and">
                    <econdition field-name="CarStatus" value="Reception"/>
                    <econdition field-name="OutTime" from="null"/>
                </econditions>
            </entity-find>
        </actions>
    </service>

    <service verb="get" noun="JobControllerAndTechnician" authenticate="false">
        <in-parameters><auto-parameters include="all"/></in-parameters>
        <out-parameters>
            <parameter name="technicianList" type="List"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="JobControllerAndTechnician" list="technicianList">
                <econditions combine="and">
                    <econdition field-name="Area" value="Ground Floor"/>
                    <econdition field-name="OutTime" from="null"/>
                </econditions>
            </entity-find>
        </actions>
    </service>

    <service verb="create" noun="SecurityCheck" authenticate="false">
        <in-parameters>
            <auto-parameters include="all"/>
        </in-parameters>
        <actions>
            <service-call name="create#service.tracker.SecurityCheck" in-map="[CarNo:CarNo, KmIn:KmIn]"/>
            <service-call name="create#service.tracker.StatusOfCar" in-map="[CarNo:CarNo, CarStatus:'Reception', InTime:ec.user.getNowTimestamp()]"/>
        </actions>
    </service>

    <service verb="get" noun="ReceptionEntityAndCarStatus" authenticate="false">
        <in-parameters>
            <auto-parameters include="all"/>
        </in-parameters>
        <out-parameters>
            <parameter name="adviserCarList" type="List"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="ReceptionEntityAndCarStatus" list="adviserCarList">
                <econditions combine="and">
                    <econdition field-name="CarStatus" value="Service Adviser"/>
                    <econdition field-name="OutTime" from="null"/>
                </econditions>
            </entity-find>
        </actions>
    </service>

    <service verb="get" noun="AdviserEntryAndCarStatus" authenticate="false">
        <in-parameters>
            <auto-parameters include="all"/>
        </in-parameters>
        <out-parameters>
            <parameter name="jobControllerCarList" type="List"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="AdviserEntryAndCarStatus" list="jobControllerCarList">
                <econditions combine="and">
                    <econdition field-name="CarStatus" value="Job Controller"/>
                    <econdition field-name="OutTime" from="null"/>
                </econditions>
            </entity-find>
        </actions>
    </service>

    <service verb="get" noun="StatusOfCar" authenticate="false">
        <in-parameters>
            <auto-parameters include="all"/>
        </in-parameters>
        <out-parameters>
            <parameter name="receptionCarList" type="List"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="StatusOfCar" list="receptionCarList">
                <econditions>
                    <econdition field-name="CarStatus" value="Reception"/>
                </econditions>
            </entity-find>
        </actions>
    </service>

    <service verb="create" noun="AdviserEntry" authenticate="false">
        <in-parameters>
            <parameter name="CarNo"/>
            <parameter name="CustomerName"/>
            <parameter name="MobileNo"/>
            <parameter name="promisedTime"/>
            <parameter name="DriverName"/>
            <parameter name="Job"/>
            <parameter name="BeforeRoadTest"/>
            <parameter name="AfterRoadTest"/>
            <parameter name="CarStatus"/>
        </in-parameters>
        <actions>
            <service-call name="create#service.tracker.AdviserEntry"  in-map="[CarNo:CarNo, CustomerName:CustomerName, MobileNo:MobileNo,
                                                                               PromisedTime:PromisedTime, DriverName:DriverName, DriverMobile:DriverMobile,
                                                                               Job:Job, BeforeRoadTest:BeforeRoadTest, AfterRoadTest:AfterRoadTest]"/>
            <service-call name="update#service.tracker.StatusOfCar" in-map="[CarNo:CarNo, CarStatus:'Service Adviser', OutTime:ec.user.getNowTimestamp()]">
                <econditions>
                    <econdition field-name="CarNo" value="${CarNo}"/>
                </econditions>
            </service-call>
            <service-call name="create#service.tracker.StatusOfCar" in-map="[CarNo:CarNo, CarStatus:'Job Controller', InTime:ec.user.getNowTimestamp()]"/>
        </actions>
    </service>

</services>